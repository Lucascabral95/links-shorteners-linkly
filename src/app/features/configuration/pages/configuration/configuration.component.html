@if (loading()) {
<loading-component />
} @else {
<!-- ----- -->
@if (errors().message !== null) {
<error-requests
  [messageError]="errors().message!"
  [codeError]="errors().status || 500"
/>
}
<!-- ----- -->
@else {
<div class="h-screen sm:h-full w-full animate-fade-in-up">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-2 md:py-16">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 lg:gap-16">
      <div class="lg:col-span-1">
        <div class="sticky top-24">
          <h2 class="text-3xl font-bold text-base-content">Tu Perfil</h2>
          <p class="mt-2 text-base text-base-content/70">
            La información de tu cuenta en un solo lugar.
          </p>
          <div class="mt-8 space-y-6">
            <div>
              <h3
                class="text-sm font-semibold text-base-content/60 tracking-wider uppercase"
              >
                Estado
              </h3>
              <div class="mt-3">
                @if (userData()?.verified) {
                <span class="badge badge-success badge-outline gap-2">
                  <svg class="h-4 w-4" fill="currentColor" viewBox="0 0 20 20">
                    <path
                      fill-rule="evenodd"
                      d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                      clip-rule="evenodd"
                    />
                  </svg>
                  Cuenta Verificada
                </span>
                } @else {
                <span class="badge badge-warning badge-outline gap-2">
                  <svg class="h-4 w-4" fill="currentColor" viewBox="0 0 20 20">
                    <path
                      d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.21 3.02-1.742 3.02H4.42c-1.532 0-2.492-1.686-1.742-3.02l5.58-9.92zM10 13a1 1 0 110-2 1 1 0 010 2zm-1-4a1 1 0 011-1h.01a1 1 0 110 2H10a1 1 0 01-1-1z"
                    />
                  </svg>
                  Pendiente de Verificación
                </span>
                }
              </div>
            </div>
            <div>
              <h3
                class="text-sm font-semibold text-base-content/60 tracking-wider uppercase"
              >
                Miembro Desde
              </h3>
              <p class="mt-3 text-lg text-base-content">
                {{ userData()?.created_at | date : "longDate" }}
              </p>
            </div>
          </div>
        </div>
      </div>

      <div class="lg:col-span-2">
        <form [formGroup]="myForm" (ngSubmit)="onSubmit()" class="space-y-8">
          <div>
            <h3 class="text-xl font-bold text-base-content">
              Información Personal
            </h3>
            <div class="divider mt-2 mb-6"></div>
            <div class="form-control w-full max-w-sm">
              <label class="label" for="full_name">
                <span class="label-text">Nombre completo</span>
              </label>
              <input
                type="text"
                id="full_name"
                formControlName="full_name"
                class="input input-bordered w-full"
                [value]="
                  userData()?.full_name || myForm.get('full_name')?.value
                "
              />
            </div>
          </div>

          <div>
            <h3 class="text-xl font-bold text-base-content">
              Detalles de la Cuenta
            </h3>
            <div class="divider mt-2"></div>
            <dl class="space-y-4">
              <div class="flex items-center">
                <dt class="w-1/4 text-sm font-medium text-base-content/70">
                  Email
                </dt>
                <dd class="w-3/4 text-base-content">
                  {{ userData()?.email }}
                </dd>
              </div>
              <div class="flex items-center">
                <dt class="w-1/4 text-sm font-medium text-base-content/70">
                  Rol
                </dt>
                <dd class="w-3/4 text-base-content capitalize">
                  {{ userData()?.role }}
                </dd>
              </div>
              <div class="flex items-center">
                <dt class="w-1/4 text-sm font-medium text-base-content/70">
                  Proveedor
                </dt>
                <dd class="w-3/4 text-base-content capitalize">
                  {{ userData()?.provider }}
                </dd>
              </div>
              <div class="flex items-center">
                <dt class="w-1/4 text-sm font-medium text-base-content/70">
                  Última actualización
                </dt>
                <dd class="w-3/4 text-base-content capitalize">
                  {{ userData()?.updated_at | date : "longDate" }}
                </dd>
              </div>
            </dl>
          </div>

          <div class="divider"></div>

          <div class="flex justify-end">
            <button
              type="submit"
              [disabled]="!myForm.dirty || myForm.invalid || loadingUpdate()"
              class="btn btn-primary min-w-40"
            >
              @if (loadingUpdate()) {
              <span class="loading loading-spinner"></span>
              Guardando... } @else { Guardar Cambios }
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
} }

<div class="fixed bottom-5 right-5 z-50">
  @if (errorUpdate() !== null ) {
  <toast-component
    [successOrError]="'error'"
    [message]="errorUpdate() || 'Error al actualizar el usuario'"
  />
  } @if (successUpdate() !== null) {
  <toast-component
    [successOrError]="'success'"
    [message]="successUpdate() || 'Usuario actualizado correctamente'"
  />
  }
</div>
